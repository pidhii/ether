
OS.chdir (List.get command_line 1)
system "pwd"

let test_mergesort! =
  let origlist = [1,9,4,5,7,6,8,2,3]
  let ret =
    origlist
    |> List.map (format "%d")
    |> String.join "\n"
    |> x -> IO.shell {q|ether ./mergesort.eth <<<'{x}' | grep "Sorted list"|q}
    |> String.match \\[.+\]/
    |> car

  let correct =
    List.sort (<) origlist
    |> List.map (format "%d")
    |> String.join ","
    |> format "[%d]"

  assert ret eq correct

let test_basics! =
  assert system "ether ./basics.eth &>/dev/null" == 0

test_basics!
test_mergesort!

