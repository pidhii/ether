
OS.chdir (List.get command_line 1);

let test_mergesort! =
  let origlist = [1,9,4,5,7,6,8,2,3] in
  let ret =
    origlist
    |> List.map (format "%d")
    |> String.join "\\n"
    |> IO.shell {CMD|ether ./mergesort.eth <<<$(echo -e "%d") | grep "Sorted list"|CMD}
    |> String.match \\[.+\]/
    |> car
  in
  let correct =
    List.sort (<) origlist
    |> List.map (format "%d")
    |> String.join ","
    |> format "[%d]"
  in
  assert ret eq correct in
  nil
in

let test_basics! =
  assert system "ether ./basics.eth &>/dev/null" == 0 in
  nil
in

test_basics!;
test_mergesort!; 
